<img src="assets/logos/rip-icon-512wa.png" style="width:50px" /> <br>

# Language Enhancements

This document chronicles the language enhancements made in Rip compared to traditional CoffeeScript. Each enhancement is designed to generate cleaner, more modern JavaScript while maintaining full compatibility with existing CoffeeScript code.

## Table of Contents

1. [Bare Mode by Default](#bare-mode-by-default)
2. [Async Call Operator](#async-call-operator)

---

## 1. Bare Mode by Default

### Reason Added
Traditional CoffeeScript wraps all compiled code in an Immediately Invoked Function Expression (IIFE) to prevent variable pollution of the global scope. While this was important in the ES5 era, modern JavaScript development uses modules and build tools that make this wrapper unnecessary and visually cluttered.

### Purpose
- Generate cleaner, more readable JavaScript output
- Eliminate unnecessary function wrappers in modern development environments
- Reduce visual noise in compiled output
- Align with modern JavaScript conventions

### What It Allows
```coffeescript
# Simple CoffeeScript code
name = "World"
greeting = "Hello #{name}!"
console.log greeting
```

### Before (Traditional CoffeeScript)
```javascript
// Generated by CoffeeScript 2.7.0
(function() {
  var greeting, name;

  name = "World";

  greeting = `Hello ${name}!`;

  console.log(greeting);

}).call(this);
```

### After (Rip Enhancement)
```javascript
// Generated by Rip 0.1.0
var greeting, name;

name = "World";

greeting = `Hello ${name}!`;

console.log(greeting);
```

### Caveats
- **Global Scope**: Variables are now declared in the module scope rather than function scope
- **Legacy Code**: Existing code that relies on the IIFE wrapper may need adjustment
- **Variable Conflicts**: Potential for naming conflicts in environments without module systems

### Compatibility
- **Rip's Own Files**: Still use IIFE wrappers for bootstrap stability
- **User Code**: Gets clean bare mode output by default
- **Override**: The `--no-bare` flag can restore IIFE behavior when needed

---

## 2. Async Call Operator

### Reason Added
Writing asynchronous code with `await` can be verbose, especially for simple function calls. The async call operator (`!`) provides a concise syntax for the common pattern of awaiting a function call, making async code more readable and reducing boilerplate.

### Purpose
- Provide concise syntax for common async/await patterns
- Reduce visual noise in async function calls
- Make async code more readable and expressive
- Maintain clean separation from regular negation operator

### What It Allows
```coffeescript
# Async calls with clean syntax
user = User.find!(1)
profile = user.getProfile!()
data = api.fetch!("/users", {limit: 10})

# Works in all contexts
if api.check!()
  console.log db.query!("SELECT * FROM users")
```

### Before (Traditional CoffeeScript)
```javascript
// Generated by CoffeeScript 2.7.0
var data, profile, user;

user = await User.find(1);

profile = await user.getProfile();

data = await api.fetch("/users", {
  limit: 10
});

if (await api.check()) {
  console.log(await db.query("SELECT * FROM users"));
}
```

### After (Rip Enhancement)
```javascript
// Generated by Rip 0.1.0
var data, profile, user;

user = await User.find(1);

profile = await user.getProfile();

data = await api.fetch("/users", {
  limit: 10
});

if (await api.check()) {
  console.log(await db.query("SELECT * FROM users"));
}
```

### Key Features
- **Implicit Parentheses**: `fetch!` becomes `await fetch()` for zero-argument calls
- **With Arguments**: `api.fetch!("data")` becomes `await api.fetch("data")`
- **Property Access**: `user.save!` becomes `await user.save()`
- **Method Chaining**: `user.load!.process()` becomes `await user.load().process()`
- **Preserved Negation**: `!user.active` remains unchanged as regular boolean negation

### Caveats
- **Scope Requirements**: Can only be used within async functions or top-level modules
- **Parsing**: The `!` must immediately follow an identifier with no whitespace
- **Negation Distinction**: Regular negation `!condition` is preserved and unaffected

### Compatibility
- **Zero Breaking Changes**: All existing CoffeeScript code continues to work
- **Additive Enhancement**: Provides new syntax without changing existing behavior
- **Future Expansion**: Foundation for potential async chaining enhancements

---

*This document is updated as new language enhancements are added to Rip.*